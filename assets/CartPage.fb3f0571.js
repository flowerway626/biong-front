import{as as $,r as p,I as A,aX as S,S as N,c as O,j as u,k as y,l as i,d as l,K as n,N as k,A as T,O as s,F as C,at as D,V as g,q as f,W as F,M as P}from"./index.e2f377c7.js";import{Q as U,a as b}from"./QTable.368c0299.js";import{Q as j}from"./QInput.fe67ba2a.js";import{Q as q}from"./QCardSection.2335a465.js";import{Q as L}from"./QCard.3f9d0f50.js";import{Q as E}from"./QDialog.17f6cf01.js";import{u as K}from"./use-quasar.23bb4798.js";import"./QItemLabel.987c8214.js";import"./use-key-composition.5af287d2.js";import"./uid.42677368.js";const M={class:"q-pa-md",id:"setting-cart"},R=["src"],W={class:"flex justify-around items-center q-mt-md q-gutter-md"},X={class:"text-h5 text-weight-bold"},G=i("div",{class:"text-center text-subtitle1"},"\u8A02\u55AE\u78BA\u8A8D",-1),H={style:{"padding-left":"20px"}},ie={__name:"CartPage",setup(J){const h=D(),w=K(),x=$(),d=p(!1),{editCart:Q,checkOut:I}=x,o=p(!1),v=p(!1),_=p(""),r=A([]);(async()=>{var a,t;try{d.value=!0;const{data:e}=await S.get("/users/cart");r.push(...e.result),d.value=!1,console.log(r)}catch(e){N.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"\u8CFC\u7269\u8ECA\u932F\u8AA4\uFF01"})}})();const V=[{name:"name",required:!0,label:"\u5546\u54C1\u540D\u7A31",align:"center",field:a=>a.p_id.name,sortable:!0,sort:(a,t)=>parseInt(a,10)-parseInt(t,10)},{name:"image",required:!0,label:"\u5716\u7247",align:"center",field:a=>a.p_id.image},{name:"price",required:!0,label:"\u55AE\u50F9",align:"center",field:a=>a.p_id.price,sortable:!0,sort:(a,t)=>parseInt(a,10)-parseInt(t,10)},{name:"quantity",required:!0,label:"\u6578\u91CF",align:"center",field:a=>a.quantity,sortable:!0,sort:(a,t)=>parseInt(a,10)-parseInt(t,10)},{name:"total",required:!0,label:"\u5C0F\u8A08",align:"center",field:a=>a.p_id.price*a.quantity,sortable:!0,sort:(a,t)=>parseInt(a,10)-parseInt(t,10)},{name:"other",required:!0,label:"\u64CD\u4F5C",align:"center"}],c=async(a,t)=>{const e=r.findIndex(m=>m._id===a);await Q({_id:r[e].p_id._id,quantity:t}),r[e].quantity+=t,r[e].quantity<=0?(r.splice(e,1),w.notify({type:"positive",color:"pink",message:"\u6210\u529F\u522A\u9664\u5546\u54C1",position:"top"})):w.notify({type:"positive",color:"warning",message:"\u4FEE\u6539\u6578\u91CF\u5B8C\u6210",position:"top"})},z=O(()=>r.reduce((a,t)=>a+t.p_id.price*t.quantity,0)),B=async()=>{d.value=!0,await I(),r.splice(0,r.length),h.push("/setting/order"),d.value=!1};return(a,t)=>(u(),y(C,null,[i("div",M,[l(U,{class:"cart-table",title:"\u8CFC\u7269\u8ECA",rows:r,columns:V,"row-key":"_id",filter:_.value,"virtual-scroll":"",flat:"",loading:d.value},{"body-cell-image":n(e=>[l(b,null,{default:n(()=>[i("img",{src:e.row.p_id.image,width:130,height:100},null,8,R)]),_:2},1024)]),"body-cell-quantity":n(e=>[l(b,null,{default:n(()=>[o.value?(u(),g(s,{key:0,icon:"mdi-minus",round:"",outline:"",unelevated:"",size:"sm",color:"warning",onClick:m=>c(e.row._id,-1)},null,8,["onClick"])):f("",!0),i("span",null,"\xA0\xA0 "+k(e.row.quantity)+" \xA0\xA0",1),o.value?(u(),g(s,{key:1,icon:"mdi-plus",round:"",outline:"",unelevated:"",size:"sm",color:"warning",onClick:m=>c(e.row._id,1)},null,8,["onClick"])):f("",!0)]),_:2},1024)]),"body-cell-other":n(e=>[l(b,{class:"q-gutter-x-sm"},{default:n(()=>[l(s,{icon:"delete",round:"",unelevated:"",size:"sm",color:"pink",onClick:m=>c(e.row._id,e.row.quantity*-1)},null,8,["onClick"])]),_:2},1024)]),"top-right":n(()=>[l(j,{class:"q-mr-md",borderless:"",dense:"",debounce:"300",modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=e=>_.value=e),placeholder:"Search"},{append:n(()=>[l(F,{name:"search"})]),_:1},8,["modelValue"]),o.value?f("",!0):(u(),g(s,{key:0,icon:"edit",label:"\u7DE8\u8F2F",outline:"",unelevated:"",size:"sm",color:"secondary",onClick:t[2]||(t[2]=e=>o.value=!o.value)})),o.value?(u(),g(s,{key:1,icon:"check",label:"\u78BA\u8A8D",outline:"",unelevated:"",size:"sm",color:"secondary",onClick:t[3]||(t[3]=e=>o.value=!o.value)})):f("",!0)]),default:n(()=>[l(s,{icon:"delete",round:"",unelevated:"",size:"sm",color:"pink",onClick:t[0]||(t[0]=e=>c(a.props.row._id,a.props.row.quantity*-1))})]),_:1},8,["rows","filter","loading"]),i("div",W,[i("div",X,"TOTAL\uFF1A "+k(T(z))+" \u5143",1),l(s,{icon:"money",label:"\u7D50\u5E33 go",unelevated:"",push:"",size:"lg",color:"warning","text-color":"black",onClick:t[4]||(t[4]=e=>v.value=!0)})])]),l(E,{modelValue:v.value,"onUpdate:modelValue":t[5]||(t[5]=e=>v.value=e)},{default:n(()=>[l(L,null,{default:n(()=>[l(q,{style:{background:"linear-gradient(135deg, #53C2BA 0%, #C0538A 100%)"}},{default:n(()=>[G]),_:1}),l(q,null,{default:n(()=>[i("ul",H,[(u(!0),y(C,null,P(r,e=>(u(),y("li",{key:e._id},[i("span",null,k(e.p_id.name+" x "+e.quantity),1)]))),128))])]),_:1}),l(q,{class:"text-center"},{default:n(()=>[l(s,{label:"\u9001\u51FA\u8A02\u55AE",push:"",size:"sm",color:"secondary",onClick:B})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ie as default};
