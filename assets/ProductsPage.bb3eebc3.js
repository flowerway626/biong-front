import{Q as k}from"./QTd.d3b3c631.js";import{B as z,c as C,h as x,N as S,r as w,H as I,bc as h,S as Q,j as f,k as N,l as c,d as t,K as s,F as T,ay as D,O as p,J as b,q as V,R as E,Q as H,U,ag as O,bm as j}from"./index.e3ca944d.js";import{u as J,b as K,c as M,Q as R,a as G}from"./QTable.c9e8e1f4.js";import{Q as _}from"./QInput.0bd5fdb1.js";import{Q as L}from"./QSelect.289447c3.js";import{Q as W}from"./QFile.cc765851.js";import{Q as X,a as Y}from"./QCard.a8b9ca30.js";import{Q as Z}from"./QCardActions.3d9b9d37.js";import{Q as ee}from"./QForm.9bfe2ddd.js";import{Q as le}from"./QDialog.944aab54.js";import{C as ae}from"./ClosePopup.b6b1cb13.js";import"./use-key-composition.d9ee2061.js";var B=z({name:"QToggle",props:{...J,icon:String,iconColor:String},emits:K,setup(g){function v(i,d){const u=C(()=>(i.value===!0?g.checkedIcon:d.value===!0?g.indeterminateIcon:g.uncheckedIcon)||g.icon),m=C(()=>i.value===!0?g.iconColor:null);return()=>[x("div",{class:"q-toggle__track"}),x("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},u.value!==void 0?[x(S,{name:u.value,color:m.value})]:void 0)]}return M("toggle",v)}});const oe={class:"q-ma-md q-px-md"},te=c("div",{class:"backH4 text-h4 text-center"},"\u5546\u54C1\u7BA1\u7406",-1),se=["src"],re={class:"text-h5 q-ma-sm text-weight-bold"},ne={class:"row"},ie={class:"col-6 q-pt-md"},de={class:"flex"},ue={class:"col-6 q-pt-md"},_e={__name:"ProductsPage",setup(g){const v=w(""),i=w(!1),d=w(!1),u=w(!1),m=D(),n=I([]),$=["\u670D\u98FE","\u98FE\u54C1","\u98DF\u54C1","\u5176\u4ED6"],o=I({_id:"",name:"",price:0,description:"",image:void 0,category:"",sell:!1,idx:-1}),q=l=>{const e=n.findIndex(a=>a._id===l);e===-1?(o._id="",o.name="",o.price=0,o.description="",o.image=void 0,o.category="",o.sell=!1):(o._id=n[e]._id,o.name=n[e].name,o.price=n[e].price,o.description=n[e].description,o.image=n[e].image,o.category=n[e].category,o.sell=n[e].sell,o.idx=e),d.value=!0},P=async()=>{var e,a;d.value=!0,i.value=!0,m.loading.show({spinner:j,spinnerColor:"warning",spinnerSize:100,backgroundColor:"black",message:"loading...",messageColor:"white"});const l=new FormData;l.append("name",o.name),l.append("price",o.price),l.append("description",o.description),l.append("image",o.image),l.append("category",o.category),l.append("sell",o.sell);try{if(o._id.length===0){const{data:r}=await h.post("/products",l);n.push(r.result),m.notify({type:"positive",color:"secondary",message:"\u65B0\u589E\u6210\u529F",position:"top"})}else{const{data:r}=await h.patch("/products/"+o._id,l);n[o.idx]=r.result,m.notify({type:"positive",color:"pink",message:"\u7DE8\u8F2F\u6210\u529F",position:"top"})}d.value=!1}catch(r){Q.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((a=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:a.message)||"\u767C\u751F\u932F\u8AA4\uFF01"})}m.loading.hide(),i.value=!1};(async()=>{var l,e;try{u.value=!0;const{data:a}=await h.get("/products/all");n.push(...a.result),u.value=!1,d.value=!1}catch(a){Q.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((e=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:e.message)||"\u5546\u54C1\u932F\u8AA4\uFF01"})}})();const A=[{name:"name",required:!0,label:"\u540D\u7A31",align:"center",field:l=>l.name,format:l=>`${l}`,sortable:!0,sort:(l,e)=>parseInt(l,10)-parseInt(e,10)},{name:"image",required:!0,label:"\u5716\u7247",align:"center",field:l=>l.image},{name:"price",required:!0,label:"\u55AE\u50F9",align:"center",field:l=>l.price,format:l=>`${l}`,sortable:!0,sort:(l,e)=>parseInt(l,10)-parseInt(e,10)},{name:"sell",required:!0,label:"\u4E0A\u67B6\u72C0\u614B",align:"center",field:l=>l.sell,format:l=>`${l}`,sortable:!0,sort:(l,e)=>parseInt(l,10)-parseInt(e,10)},{name:"category",required:!0,label:"\u985E\u5225",align:"center",field:l=>l.category,sortable:!0},{name:"other",required:!0,label:"\u64CD\u4F5C",align:"center"}],F=async l=>{var a,r;const e=n.findIndex(y=>y._id===l);u.value=!0;try{await h.delete("/products/"+l),n.splice([e],1),u.value=!1,m.notify({type:"positive",color:"secondary",message:"\u6210\u529F\u522A\u9664\u5546\u54C1",position:"top"})}catch(y){Q.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((r=(a=y==null?void 0:y.response)==null?void 0:a.data)==null?void 0:r.message)||"\u767C\u751F\u932F\u8AA4\uFF01"})}};return(l,e)=>(f(),N(T,null,[c("div",oe,[te,t(R,{class:"product-table",title:"",rows:n,columns:A,"row-key":"_id",filter:v.value,"virtual-scroll":"",flat:"",loading:u.value},{"body-cell-image":s(a=>[t(k,null,{default:s(()=>[c("img",{src:a.row.image,width:130,height:100},null,8,se)]),_:2},1024)]),"body-cell-category":s(a=>[t(k,null,{default:s(()=>[t(p,{label:a.row.category,rounded:""},null,8,["label"])]),_:2},1024)]),"body-cell-sell":s(a=>[t(k,null,{default:s(()=>[i.value?(f(),b(B,{key:0,modelValue:a.row.sell,"onUpdate:modelValue":r=>a.row.sell=r,"checked-icon":"check",color:"warning","unchecked-icon":"clear"},null,8,["modelValue","onUpdate:modelValue"])):V("",!0),i.value?V("",!0):(f(),b(B,{key:1,modelValue:a.row.sell,"onUpdate:modelValue":r=>a.row.sell=r,disable:"","checked-icon":"check",color:"warning","unchecked-icon":"clear"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]),"body-cell-other":s(a=>[t(k,{class:"q-gutter-sm"},{default:s(()=>[i.value?V("",!0):(f(),b(p,{key:0,icon:"edit",round:"",unelevated:"",size:"sm",color:"pink",onClick:r=>q(a.row._id)},null,8,["onClick"])),i.value?(f(),b(p,{key:1,icon:"check",round:"",unelevated:"",size:"sm",color:"pink",onClick:e[0]||(e[0]=r=>i.value=!i.value)})):V("",!0),t(p,{icon:"delete",color:"pink",size:"sm",round:"",onClick:r=>F(a.row._id)},null,8,["onClick"])]),_:2},1024)]),"top-left":s(()=>[t(p,{icon:"mdi-shopping",label:"\u65B0\u589E\u5546\u54C1",color:"secondary",outline:"",unelevated:"",onClick:e[1]||(e[1]=a=>q(-1))})]),"top-right":s(()=>[t(_,{class:"q-mr-md",borderless:"",dense:"",debounce:"300",modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),placeholder:"Search"},{append:s(()=>[t(S,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter","loading"])]),t(le,{id:"admin-product",modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=a=>d.value=a),persistent:"","transition-show":"fade","transition-hide":"fade"},{default:s(()=>[t(X,{class:"my-card text-white"},{default:s(()=>[t(ee,{onSubmit:P},{default:s(()=>[t(Y,{align:"center"},{default:s(()=>[c("div",re,E(o._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u5546\u54C1"),1),c("div",ne,[c("div",ie,[t(_,{class:"q-my-xs",modelValue:o.name,"onUpdate:modelValue":e[3]||(e[3]=a=>o.name=a),label:"\u540D\u7A31",type:"text",color:"warning",rules:[l.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"]),t(L,{class:"q-my-xs",modelValue:o.category,"onUpdate:modelValue":e[4]||(e[4]=a=>o.category=a),label:"\u5206\u985E",color:"warning",options:$},null,8,["modelValue"]),c("div",de,[t(_,{class:"q-my-xs",modelValue:o.price,"onUpdate:modelValue":e[5]||(e[5]=a=>o.price=a),modelModifiers:{number:!0},label:"\u50F9\u683C",type:"number",color:"warning",rules:[l.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"]),t(G,{class:"q-my-xs",modelValue:o.sell,"onUpdate:modelValue":e[6]||(e[6]=a=>o.sell=a),label:"\u4E0A\u67B6",color:"warning"},null,8,["modelValue"])])]),c("div",ue,[t(H,{class:"q-my-sm",src:o.image,width:"150px"},null,8,["src"]),t(W,{class:"q-my-xs",modelValue:o.image,"onUpdate:modelValue":e[7]||(e[7]=a=>o.image=a),outlined:"","use-chips":"",style:{width:"150px"},label:"PHOTO"},null,8,["modelValue"])])]),t(_,{modelValue:o.description,"onUpdate:modelValue":e[8]||(e[8]=a=>o.description=a),label:"\u8AAA\u660E",type:"textarea",color:"warning",rows:"4",autogrow:"",rules:[l.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"])]),_:1}),t(Z,{align:"center"},{default:s(()=>[t(p,{type:"submit",size:"md",color:"secondary"},{default:s(()=>[U("\u78BA\u5B9A")]),_:1}),O((f(),b(p,{size:"md",color:"pink"},{default:s(()=>[U("\u53D6\u6D88")]),_:1})),[[ae]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{_e as default};
