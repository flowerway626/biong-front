import{ah as $,r as p,I as A,b2 as S,S as O,c as P,j as u,k as y,l as o,d as l,L as n,U as k,A as T,P as i,F as C,M as U,K as v,q as g,O as D,R as F}from"./index.4046859c.js";import{Q as L,a as b}from"./QTable.3b7822dc.js";import{Q as N}from"./QInput.57e94cdd.js";import{Q as j,a as q}from"./QCard.fcd3e338.js";import{Q as R}from"./QDialog.d02a7f6f.js";import{u as E}from"./use-quasar.1c262b72.js";import"./QSelect.4ff5345a.js";import"./use-key-composition.31053255.js";const H={class:"q-pa-md",id:"cart"},K=o("div",{class:"text-center text-h4 backH4"},"\u8CFC\u7269\u8ECA",-1),M=["src"],G={class:"flex justify-around items-center q-mt-md q-gutter-md"},J={class:"text-h5 text-weight-bold"},W=o("div",{class:"text-center text-subtitle1"},"\u8A02\u55AE\u78BA\u8A8D",-1),X={style:{"padding-left":"20px"}},se={__name:"CartPage",setup(Y){const h=U(),w=E(),x=$(),d=p(!1),{editCart:I,checkOut:Q}=x,s=p(!1),f=p(!1),_=p(""),r=A([]);(async()=>{var a,t;try{d.value=!0;const{data:e}=await S.get("/users/cart");r.push(...e.result),d.value=!1,console.log(r)}catch(e){O.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((t=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:t.message)||"\u8CFC\u7269\u8ECA\u932F\u8AA4\uFF01"})}})();const V=[{name:"name",required:!0,label:"\u5546\u54C1\u540D\u7A31",align:"center",field:a=>a.p_id.name,sortable:!0,sort:(a,t)=>parseInt(a,10)-parseInt(t,10)},{name:"image",required:!0,label:"\u5716\u7247",align:"center",field:a=>a.p_id.image},{name:"price",required:!0,label:"\u55AE\u50F9",align:"center",field:a=>a.p_id.price,sortable:!0,sort:(a,t)=>parseInt(a,10)-parseInt(t,10)},{name:"quantity",required:!0,label:"\u6578\u91CF",align:"center",field:a=>a.quantity,sortable:!0,sort:(a,t)=>parseInt(a,10)-parseInt(t,10)},{name:"total",required:!0,label:"\u5C0F\u8A08",align:"center",field:a=>a.p_id.price*a.quantity,sortable:!0,sort:(a,t)=>parseInt(a,10)-parseInt(t,10)},{name:"other",required:!0,label:"\u64CD\u4F5C",align:"center"}],c=async(a,t)=>{const e=r.findIndex(m=>m._id===a);await I({_id:r[e].p_id._id,quantity:t}),r[e].quantity+=t,r[e].quantity<=0?(r.splice(e,1),w.notify({type:"positive",color:"pink",message:"\u6210\u529F\u522A\u9664\u5546\u54C1",position:"top"})):w.notify({type:"positive",color:"warning",message:"\u4FEE\u6539\u6578\u91CF\u5B8C\u6210",position:"top"})},z=P(()=>r.reduce((a,t)=>a+t.p_id.price*t.quantity,0)),B=async()=>{d.value=!0,await Q(),r.splice(0,r.length),h.push("/setting/order"),d.value=!1};return(a,t)=>(u(),y(C,null,[o("div",H,[K,l(L,{class:"cart-table",rows:r,columns:V,"row-key":"_id",filter:_.value,"virtual-scroll":"",flat:"",loading:d.value},{"body-cell-image":n(e=>[l(b,null,{default:n(()=>[o("img",{src:e.row.p_id.image,width:130,height:100},null,8,M)]),_:2},1024)]),"body-cell-quantity":n(e=>[l(b,null,{default:n(()=>[s.value?(u(),v(i,{key:0,icon:"mdi-minus",round:"",outline:"",unelevated:"",size:"sm",color:"warning",onClick:m=>c(e.row._id,-1)},null,8,["onClick"])):g("",!0),o("span",null,"\xA0\xA0 "+k(e.row.quantity)+" \xA0\xA0",1),s.value?(u(),v(i,{key:1,icon:"mdi-plus",round:"",outline:"",unelevated:"",size:"sm",color:"warning",onClick:m=>c(e.row._id,1)},null,8,["onClick"])):g("",!0)]),_:2},1024)]),"body-cell-other":n(e=>[l(b,{class:"q-gutter-x-sm"},{default:n(()=>[l(i,{icon:"delete",round:"",unelevated:"",size:"sm",color:"pink",onClick:m=>c(e.row._id,e.row.quantity*-1)},null,8,["onClick"])]),_:2},1024)]),"top-right":n(()=>[l(N,{class:"q-mr-md",borderless:"",dense:"",debounce:"300",modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=e=>_.value=e),placeholder:"Search"},{append:n(()=>[l(D,{name:"search"})]),_:1},8,["modelValue"]),s.value?g("",!0):(u(),v(i,{key:0,icon:"edit",label:"\u7DE8\u8F2F",outline:"",unelevated:"",size:"sm",color:"secondary",onClick:t[2]||(t[2]=e=>s.value=!s.value)})),s.value?(u(),v(i,{key:1,icon:"check",label:"\u78BA\u8A8D",outline:"",unelevated:"",size:"sm",color:"secondary",onClick:t[3]||(t[3]=e=>s.value=!s.value)})):g("",!0)]),default:n(()=>[l(i,{icon:"delete",round:"",unelevated:"",size:"sm",color:"pink",onClick:t[0]||(t[0]=e=>c(a.props.row._id,a.props.row.quantity*-1))})]),_:1},8,["rows","filter","loading"]),o("div",G,[o("div",J,"TOTAL\uFF1A "+k(T(z))+" \u5143",1),l(i,{icon:"money",label:"\u7D50\u5E33 go",unelevated:"",push:"",size:"lg",color:"warning","text-color":"black",onClick:t[4]||(t[4]=e=>f.value=!0)})])]),l(R,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=e=>f.value=e)},{default:n(()=>[l(j,null,{default:n(()=>[l(q,{style:{background:"linear-gradient(135deg, #53C2BA 0%, #C0538A 100%)"}},{default:n(()=>[W]),_:1}),l(q,null,{default:n(()=>[o("ul",X,[(u(!0),y(C,null,F(r,e=>(u(),y("li",{key:e._id},[o("span",null,k(e.p_id.name+" x "+e.quantity),1)]))),128))])]),_:1}),l(q,{class:"text-center"},{default:n(()=>[l(i,{label:"\u9001\u51FA\u8A02\u55AE",push:"",size:"sm",color:"secondary",onClick:B})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{se as default};
