import{u as z,c as N,d as T,Q as D,a as k,b as E}from"./QTable.ed3ae8a1.js";import{B as H,c as C,h as x,N as S,r as w,H as I,b2 as h,S as Q,j as f,k as O,l as c,d as t,K as r,F as j,O as p,J as b,q as V,R as J,Q as K,U,ai as M}from"./index.de5b4897.js";import{Q as _}from"./QInput.d0e8410d.js";import{Q as R}from"./QSelect.fb61156b.js";import{Q as G}from"./QFile.8c77f0a8.js";import{Q as L,a as W}from"./QCard.1316bbc4.js";import{Q as X}from"./QCardActions.1eef0901.js";import{Q as Y}from"./QForm.b74841c2.js";import{Q as Z}from"./QDialog.d012c1c9.js";import{C as ee}from"./ClosePopup.7df4bf02.js";import{u as le}from"./use-quasar.00d1d5e7.js";import{Q as oe}from"./QSpinnerPie.1ce40f32.js";import"./use-key-composition.1763bbe6.js";var B=H({name:"QToggle",props:{...z,icon:String,iconColor:String},emits:N,setup(g){function v(i,d){const u=C(()=>(i.value===!0?g.checkedIcon:d.value===!0?g.indeterminateIcon:g.uncheckedIcon)||g.icon),m=C(()=>i.value===!0?g.iconColor:null);return()=>[x("div",{class:"q-toggle__track"}),x("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},u.value!==void 0?[x(S,{name:u.value,color:m.value})]:void 0)]}return T("toggle",v)}});const ae={class:"q-ma-md q-px-md"},te=c("div",{class:"backH4 text-h4 text-center"},"\u5546\u54C1\u7BA1\u7406",-1),re=["src"],se={class:"text-h5 q-ma-sm text-weight-bold"},ne={class:"row"},ie={class:"col-6 q-pt-md"},de={class:"flex"},ue={class:"col-6 q-pt-md"},xe={__name:"ProductsPage",setup(g){const v=w(""),i=w(!1),d=w(!1),u=w(!1),m=le(),n=I([]),$=["\u670D\u98FE","\u98FE\u54C1","\u98DF\u54C1","\u5176\u4ED6"],a=I({_id:"",name:"",price:0,description:"",image:void 0,category:"",sell:!1,idx:-1}),q=l=>{const e=n.findIndex(o=>o._id===l);e===-1?(a._id="",a.name="",a.price=0,a.description="",a.image=void 0,a.category="",a.sell=!1):(a._id=n[e]._id,a.name=n[e].name,a.price=n[e].price,a.description=n[e].description,a.image=n[e].image,a.category=n[e].category,a.sell=n[e].sell,a.idx=e),d.value=!0},P=async()=>{var e,o;d.value=!0,i.value=!0,m.loading.show({spinner:oe,spinnerColor:"warning",spinnerSize:100,backgroundColor:"black",message:"loading...",messageColor:"white"});const l=new FormData;l.append("name",a.name),l.append("price",a.price),l.append("description",a.description),l.append("image",a.image),l.append("category",a.category),l.append("sell",a.sell);try{if(a._id.length===0){const{data:s}=await h.post("/products",l);n.push(s.result),m.notify({type:"positive",color:"secondary",message:"\u65B0\u589E\u6210\u529F",position:"top"})}else{const{data:s}=await h.patch("/products/"+a._id,l);n[a.idx]=s.result,m.notify({type:"positive",color:"pink",message:"\u7DE8\u8F2F\u6210\u529F",position:"top"})}d.value=!1}catch(s){Q.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((o=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:o.message)||"\u767C\u751F\u932F\u8AA4\uFF01"})}m.loading.hide(),i.value=!1};(async()=>{var l,e;try{u.value=!0;const{data:o}=await h.get("/products/all");n.push(...o.result),u.value=!1,d.value=!1}catch(o){Q.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((e=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:e.message)||"\u5546\u54C1\u932F\u8AA4\uFF01"})}})();const A=[{name:"name",required:!0,label:"\u540D\u7A31",align:"center",field:l=>l.name,format:l=>`${l}`,sortable:!0,sort:(l,e)=>parseInt(l,10)-parseInt(e,10)},{name:"image",required:!0,label:"\u5716\u7247",align:"center",field:l=>l.image},{name:"price",required:!0,label:"\u55AE\u50F9",align:"center",field:l=>l.price,format:l=>`${l}`,sortable:!0,sort:(l,e)=>parseInt(l,10)-parseInt(e,10)},{name:"sell",required:!0,label:"\u4E0A\u67B6\u72C0\u614B",align:"center",field:l=>l.sell,format:l=>`${l}`,sortable:!0,sort:(l,e)=>parseInt(l,10)-parseInt(e,10)},{name:"category",required:!0,label:"\u985E\u5225",align:"center",field:l=>l.category,sortable:!0},{name:"other",required:!0,label:"\u64CD\u4F5C",align:"center"}],F=async l=>{var o,s;const e=n.findIndex(y=>y._id===l);u.value=!0;try{await h.delete("/products/"+l),n.splice([e],1),u.value=!1,m.notify({type:"positive",color:"secondary",message:"\u6210\u529F\u522A\u9664\u5546\u54C1",position:"top"})}catch(y){Q.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((s=(o=y==null?void 0:y.response)==null?void 0:o.data)==null?void 0:s.message)||"\u767C\u751F\u932F\u8AA4\uFF01"})}};return(l,e)=>(f(),O(j,null,[c("div",ae,[te,t(D,{class:"product-table",title:"",rows:n,columns:A,"row-key":"_id",filter:v.value,"virtual-scroll":"",flat:"",loading:u.value},{"body-cell-image":r(o=>[t(k,null,{default:r(()=>[c("img",{src:o.row.image,width:130,height:100},null,8,re)]),_:2},1024)]),"body-cell-category":r(o=>[t(k,null,{default:r(()=>[t(p,{label:o.row.category,rounded:""},null,8,["label"])]),_:2},1024)]),"body-cell-sell":r(o=>[t(k,null,{default:r(()=>[i.value?(f(),b(B,{key:0,modelValue:o.row.sell,"onUpdate:modelValue":s=>o.row.sell=s,"checked-icon":"check",color:"warning","unchecked-icon":"clear"},null,8,["modelValue","onUpdate:modelValue"])):V("",!0),i.value?V("",!0):(f(),b(B,{key:1,modelValue:o.row.sell,"onUpdate:modelValue":s=>o.row.sell=s,disable:"","checked-icon":"check",color:"warning","unchecked-icon":"clear"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]),"body-cell-other":r(o=>[t(k,{class:"q-gutter-sm"},{default:r(()=>[i.value?V("",!0):(f(),b(p,{key:0,icon:"edit",round:"",unelevated:"",size:"sm",color:"pink",onClick:s=>q(o.row._id)},null,8,["onClick"])),i.value?(f(),b(p,{key:1,icon:"check",round:"",unelevated:"",size:"sm",color:"pink",onClick:e[0]||(e[0]=s=>i.value=!i.value)})):V("",!0),t(p,{icon:"delete",color:"pink",size:"sm",round:"",onClick:s=>F(o.row._id)},null,8,["onClick"])]),_:2},1024)]),"top-left":r(()=>[t(p,{icon:"mdi-shopping",label:"\u65B0\u589E\u5546\u54C1",color:"secondary",outline:"",unelevated:"",onClick:e[1]||(e[1]=o=>q(-1))})]),"top-right":r(()=>[t(_,{class:"q-mr-md",borderless:"",dense:"",debounce:"300",modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=o=>v.value=o),placeholder:"Search"},{append:r(()=>[t(S,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter","loading"])]),t(Z,{id:"admin-product",modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=o=>d.value=o),persistent:"","transition-show":"fade","transition-hide":"fade"},{default:r(()=>[t(L,{class:"my-card text-white"},{default:r(()=>[t(Y,{onSubmit:P},{default:r(()=>[t(W,{align:"center"},{default:r(()=>[c("div",se,J(a._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u5546\u54C1"),1),c("div",ne,[c("div",ie,[t(_,{class:"q-my-xs",modelValue:a.name,"onUpdate:modelValue":e[3]||(e[3]=o=>a.name=o),label:"\u540D\u7A31",type:"text",color:"warning",rules:[l.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"]),t(R,{class:"q-my-xs",modelValue:a.category,"onUpdate:modelValue":e[4]||(e[4]=o=>a.category=o),label:"\u5206\u985E",color:"warning",options:$},null,8,["modelValue"]),c("div",de,[t(_,{class:"q-my-xs",modelValue:a.price,"onUpdate:modelValue":e[5]||(e[5]=o=>a.price=o),modelModifiers:{number:!0},label:"\u50F9\u683C",type:"number",color:"warning",rules:[l.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"]),t(E,{class:"q-my-xs",modelValue:a.sell,"onUpdate:modelValue":e[6]||(e[6]=o=>a.sell=o),label:"\u4E0A\u67B6",color:"warning"},null,8,["modelValue"])])]),c("div",ue,[t(K,{class:"q-my-sm",src:a.image,width:"150px"},null,8,["src"]),t(G,{class:"q-my-xs",modelValue:a.image,"onUpdate:modelValue":e[7]||(e[7]=o=>a.image=o),outlined:"","use-chips":"",style:{width:"150px"},label:"PHOTO"},null,8,["modelValue"])])]),t(_,{modelValue:a.description,"onUpdate:modelValue":e[8]||(e[8]=o=>a.description=o),label:"\u8AAA\u660E",type:"textarea",color:"warning",rows:"4",autogrow:"",rules:[l.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"])]),_:1}),t(X,{align:"center"},{default:r(()=>[t(p,{type:"submit",size:"md",color:"secondary"},{default:r(()=>[U("\u78BA\u5B9A")]),_:1}),M((f(),b(p,{size:"md",color:"pink"},{default:r(()=>[U("\u53D6\u6D88")]),_:1})),[[ee]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{xe as default};
