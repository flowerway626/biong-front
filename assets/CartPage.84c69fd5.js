import{ag as B,r as p,I as A,aW as S,S as N,c as O,j as u,k as y,l as i,d as l,L as r,O as k,A as P,P as s,F as C,M as T,K as f,q as g,aa as D,N as F}from"./index.21ecd052.js";import{a as L,Q as b}from"./QTable.ac56d0ac.js";import{Q as U}from"./QInput.99f6a870.js";import{Q as q}from"./QCardSection.b1198813.js";import{Q as j}from"./QCard.b08cb9e7.js";import{Q as E}from"./QDialog.68203595.js";import{u as K}from"./use-quasar.947466d0.js";import"./QItemLabel.57b23172.js";import"./uid.42677368.js";const M={class:"q-pa-md",id:"setting-cart"},R=["src"],W={class:"flex justify-around items-center q-mt-md q-gutter-md"},G={class:"text-h5 text-weight-bold"},H=i("div",{class:"text-center text-subtitle1"},"\u8A02\u55AE\u78BA\u8A8D",-1),J={style:{"padding-left":"20px"}},se={__name:"CartPage",setup(X){const h=T(),w=K(),x=B(),d=p(!1),{editCart:Q,checkOut:I}=x,n=p(!1),v=p(!1),_=p(""),o=A([]);(async()=>{var e,t;try{d.value=!0;const{data:a}=await S.get("/users/cart");o.push(...a.result),d.value=!1,console.log(o)}catch(a){N.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((t=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:t.message)||"\u8CFC\u7269\u8ECA\u932F\u8AA4\uFF01"})}})();const $=[{name:"name",required:!0,label:"\u5546\u54C1\u540D\u7A31",align:"center",field:e=>e.p_id.name,format:e=>`${e}`,sortable:!0,sort:(e,t)=>parseInt(e,10)-parseInt(t,10)},{name:"image",required:!0,label:"\u5716\u7247",align:"center",field:e=>e.p_id.image},{name:"price",required:!0,label:"\u55AE\u50F9",align:"center",field:e=>e.p_id.price,format:e=>`${e}`,sortable:!0,sort:(e,t)=>parseInt(e,10)-parseInt(t,10)},{name:"quantity",required:!0,label:"\u6578\u91CF",align:"center",field:e=>e.quantity,format:e=>`${e}`,sortable:!0,sort:(e,t)=>parseInt(e,10)-parseInt(t,10)},{name:"total",required:!0,label:"\u5C0F\u8A08",align:"center",field:e=>e.p_id.price,format:(e,t)=>`${e*t.quantity}`,sortable:!0,sort:(e,t)=>parseInt(e,10)-parseInt(t,10)},{name:"other",required:!0,label:"\u64CD\u4F5C",align:"center"}],c=async(e,t)=>{const a=o.findIndex(m=>m._id===e);await Q({_id:o[a].p_id._id,quantity:t}),o[a].quantity+=t,o[a].quantity<=0?(o.splice(a,1),w.notify({type:"positive",color:"pink",message:"\u6210\u529F\u522A\u9664\u5546\u54C1",position:"top"})):w.notify({type:"positive",color:"warning",message:"\u4FEE\u6539\u6578\u91CF\u5B8C\u6210",position:"top"})},V=O(()=>o.reduce((e,t)=>e+t.p_id.price*t.quantity,0)),z=async()=>{d.value=!0,await I(),o.splice(0,o.length),h.push("/setting/order"),d.value=!1};return(e,t)=>(u(),y(C,null,[i("div",M,[l(L,{class:"cart-table",title:"\u8CFC\u7269\u8ECA",rows:o,columns:$,"row-key":"_id",filter:_.value,"virtual-scroll":"",flat:"",loading:d.value},{"body-cell-image":r(a=>[l(b,null,{default:r(()=>[i("img",{src:a.row.p_id.image,width:130,height:100},null,8,R)]),_:2},1024)]),"body-cell-quantity":r(a=>[l(b,null,{default:r(()=>[n.value?(u(),f(s,{key:0,icon:"mdi-minus",round:"",outline:"",unelevated:"",size:"sm",color:"warning",onClick:m=>c(a.row._id,-1)},null,8,["onClick"])):g("",!0),i("span",null,"\xA0\xA0 "+k(a.row.quantity)+" \xA0\xA0",1),n.value?(u(),f(s,{key:1,icon:"mdi-plus",round:"",outline:"",unelevated:"",size:"sm",color:"warning",onClick:m=>c(a.row._id,1)},null,8,["onClick"])):g("",!0)]),_:2},1024)]),"body-cell-other":r(a=>[l(b,{class:"q-gutter-x-sm"},{default:r(()=>[l(s,{icon:"delete",round:"",unelevated:"",size:"sm",color:"pink",onClick:m=>c(a.row._id,a.row.quantity*-1)},null,8,["onClick"])]),_:2},1024)]),"top-right":r(()=>[l(U,{class:"q-mr-md",borderless:"",dense:"",debounce:"300",modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=a=>_.value=a),placeholder:"Search"},{append:r(()=>[l(D,{name:"search"})]),_:1},8,["modelValue"]),n.value?g("",!0):(u(),f(s,{key:0,icon:"edit",label:"\u7DE8\u8F2F",outline:"",unelevated:"",size:"sm",color:"secondary",onClick:t[2]||(t[2]=a=>n.value=!n.value)})),n.value?(u(),f(s,{key:1,icon:"check",label:"\u78BA\u8A8D",outline:"",unelevated:"",size:"sm",color:"secondary",onClick:t[3]||(t[3]=a=>n.value=!n.value)})):g("",!0)]),default:r(()=>[l(s,{icon:"delete",round:"",unelevated:"",size:"sm",color:"pink",onClick:t[0]||(t[0]=a=>c(e.props.row._id,e.props.row.quantity*-1))})]),_:1},8,["rows","filter","loading"]),i("div",W,[i("div",G,"TOTAL\uFF1A "+k(P(V))+" \u5143",1),l(s,{icon:"money",label:"\u7D50\u5E33 go",unelevated:"",push:"",size:"lg",color:"warning","text-color":"black",onClick:t[4]||(t[4]=a=>v.value=!0)})])]),l(E,{modelValue:v.value,"onUpdate:modelValue":t[5]||(t[5]=a=>v.value=a)},{default:r(()=>[l(j,null,{default:r(()=>[l(q,{style:{background:"linear-gradient(135deg, #53C2BA 0%, #C0538A 100%)"}},{default:r(()=>[H]),_:1}),l(q,null,{default:r(()=>[i("ul",J,[(u(!0),y(C,null,F(o,a=>(u(),y("li",{key:a._id},[i("span",null,k(a.p_id.name+" x "+a.quantity),1)]))),128))])]),_:1}),l(q,{class:"text-center"},{default:r(()=>[l(s,{label:"\u9001\u51FA\u8A02\u55AE",push:"",size:"sm",color:"secondary",onClick:z})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{se as default};
