import{u as z,d as T,e as D,a as N,Q as k,f as E,b as O}from"./QTable.ac56d0ac.js";import{B as H,c as C,h as x,aa as P,r as h,I,aW as w,S as Q,j as f,k as j,l as c,d as t,L as r,F as K,P as p,K as b,q as V,O as L,R as B,ah as M}from"./index.21ecd052.js";import{Q as _}from"./QInput.99f6a870.js";import{Q as R}from"./QImg.df07506e.js";import{Q as W,a as G}from"./QSpinnerPie.aeb3398e.js";import{Q as J}from"./QCardSection.b1198813.js";import{Q as X}from"./QCardActions.a53e45d3.js";import{Q as Y}from"./QForm.8ed12ead.js";import{Q as Z}from"./QCard.b08cb9e7.js";import{Q as ee}from"./QDialog.68203595.js";import{C as le}from"./ClosePopup.db82a542.js";import{u as ae}from"./use-quasar.947466d0.js";import"./QItemLabel.57b23172.js";import"./uid.42677368.js";var U=H({name:"QToggle",props:{...z,icon:String,iconColor:String},emits:T,setup(g){function v(i,d){const u=C(()=>(i.value===!0?g.checkedIcon:d.value===!0?g.indeterminateIcon:g.uncheckedIcon)||g.icon),m=C(()=>i.value===!0?g.iconColor:null);return()=>[x("div",{class:"q-toggle__track"}),x("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},u.value!==void 0?[x(P,{name:u.value,color:m.value})]:void 0)]}return D("toggle",v)}});const oe={class:"q-ma-md q-px-md"},te=c("div",{class:"text-h4 text-center",id:"backH4"},"\u5546\u54C1\u7BA1\u7406",-1),re=["src"],se={class:"text-h5 q-ma-sm text-weight-bold"},ne={class:"row"},ie={class:"col-6 q-pt-md"},de={class:"flex"},ue={class:"col-6 q-pt-md"},Qe={__name:"ProductsPage",setup(g){const v=h(""),i=h(!1),d=h(!1),u=h(!1),m=ae(),n=I([]),S=["\u670D\u98FE","\u98FE\u54C1","\u98DF\u54C1","\u5176\u4ED6"],o=I({_id:"",name:"",price:0,description:"",image:void 0,category:"",sell:!1,idx:-1}),q=l=>{const e=n.findIndex(a=>a._id===l);e===-1?(o._id="",o.name="",o.price=0,o.description="",o.image=void 0,o.category="",o.sell=!1):(o._id=n[e]._id,o.name=n[e].name,o.price=n[e].price,o.description=n[e].description,o.image=n[e].image,o.category=n[e].category,o.sell=n[e].sell,o.idx=e),d.value=!0},$=async()=>{var e,a;d.value=!0,i.value=!0,m.loading.show({spinner:G,spinnerColor:"warning",spinnerSize:100,backgroundColor:"black",message:"loading...",messageColor:"white"});const l=new FormData;l.append("name",o.name),l.append("price",o.price),l.append("description",o.description),l.append("image",o.image),l.append("category",o.category),l.append("sell",o.sell);try{if(o._id.length===0){const{data:s}=await w.post("/products",l);n.push(s.result),m.notify({type:"positive",color:"secondary",message:"\u65B0\u589E\u6210\u529F",position:"top"})}else{const{data:s}=await w.patch("/products/"+o._id,l);n[o.idx]=s.result,m.notify({type:"positive",color:"pink",message:"\u7DE8\u8F2F\u6210\u529F",position:"top"})}d.value=!1}catch(s){Q.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((a=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:a.message)||"\u767C\u751F\u932F\u8AA4\uFF01"})}m.loading.hide(),i.value=!1};(async()=>{var l,e;try{u.value=!0;const{data:a}=await w.get("/products/all");n.push(...a.result),u.value=!1,d.value=!1}catch(a){Q.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((e=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:e.message)||"\u5546\u54C1\u932F\u8AA4\uFF01"})}})();const A=[{name:"name",required:!0,label:"\u540D\u7A31",align:"center",field:l=>l.name,format:l=>`${l}`,sortable:!0,sort:(l,e)=>parseInt(l,10)-parseInt(e,10)},{name:"image",required:!0,label:"\u5716\u7247",align:"center",field:l=>l.image},{name:"price",required:!0,label:"\u55AE\u50F9",align:"center",field:l=>l.price,format:l=>`${l}`,sortable:!0,sort:(l,e)=>parseInt(l,10)-parseInt(e,10)},{name:"sell",required:!0,label:"\u4E0A\u67B6\u72C0\u614B",align:"center",field:l=>l.sell,format:l=>`${l}`,sortable:!0,sort:(l,e)=>parseInt(l,10)-parseInt(e,10)},{name:"category",required:!0,label:"\u985E\u5225",align:"center",field:l=>l.category,sortable:!0},{name:"other",required:!0,label:"\u64CD\u4F5C",align:"center"}],F=async l=>{var a,s;const e=n.findIndex(y=>y._id===l);u.value=!0;try{await w.delete("/products/"+l),n.splice([e],1),u.value=!1,m.notify({type:"positive",color:"secondary",message:"\u6210\u529F\u522A\u9664\u5546\u54C1",position:"top"})}catch(y){Q.fire({toast:!0,timer:1e3,showConfirmButton:!1,background:"#F5ABA5",icon:"error",color:"black",text:((s=(a=y==null?void 0:y.response)==null?void 0:a.data)==null?void 0:s.message)||"\u767C\u751F\u932F\u8AA4\uFF01"})}};return(l,e)=>(f(),j(K,null,[c("div",oe,[te,t(N,{class:"product-table",title:"",rows:n,columns:A,"row-key":"_id",filter:v.value,"virtual-scroll":"",flat:"",loading:u.value},{"body-cell-image":r(a=>[t(k,null,{default:r(()=>[c("img",{src:a.row.image,width:130,height:100},null,8,re)]),_:2},1024)]),"body-cell-category":r(a=>[t(k,null,{default:r(()=>[t(p,{label:a.row.category,rounded:""},null,8,["label"])]),_:2},1024)]),"body-cell-sell":r(a=>[t(k,null,{default:r(()=>[i.value?(f(),b(U,{key:0,modelValue:a.row.sell,"onUpdate:modelValue":s=>a.row.sell=s,"checked-icon":"check",color:"warning","unchecked-icon":"clear"},null,8,["modelValue","onUpdate:modelValue"])):V("",!0),i.value?V("",!0):(f(),b(U,{key:1,modelValue:a.row.sell,"onUpdate:modelValue":s=>a.row.sell=s,disable:"","checked-icon":"check",color:"warning","unchecked-icon":"clear"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024)]),"body-cell-other":r(a=>[t(k,{class:"q-gutter-sm"},{default:r(()=>[i.value?V("",!0):(f(),b(p,{key:0,icon:"edit",round:"",unelevated:"",size:"sm",color:"pink",onClick:s=>q(a.row._id)},null,8,["onClick"])),i.value?(f(),b(p,{key:1,icon:"check",round:"",unelevated:"",size:"sm",color:"pink",onClick:e[0]||(e[0]=s=>i.value=!i.value)})):V("",!0),t(p,{icon:"delete",color:"pink",size:"sm",round:"",onClick:s=>F(a.row._id)},null,8,["onClick"])]),_:2},1024)]),"top-left":r(()=>[t(p,{icon:"mdi-shopping",label:"\u65B0\u589E\u5546\u54C1",color:"secondary",outline:"",unelevated:"",onClick:e[1]||(e[1]=a=>q(-1))})]),"top-right":r(()=>[t(_,{class:"q-mr-md",borderless:"",dense:"",debounce:"300",modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),placeholder:"Search"},{append:r(()=>[t(P,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter","loading"])]),t(ee,{id:"admin-product",modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=a=>d.value=a),persistent:"","transition-show":"fade","transition-hide":"fade"},{default:r(()=>[t(Z,{class:"my-card text-white"},{default:r(()=>[t(Y,{onSubmit:$},{default:r(()=>[t(J,{align:"center"},{default:r(()=>[c("div",se,L(o._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u5546\u54C1"),1),c("div",ne,[c("div",ie,[t(_,{class:"q-my-xs",modelValue:o.name,"onUpdate:modelValue":e[3]||(e[3]=a=>o.name=a),label:"\u540D\u7A31",type:"text",color:"warning",rules:[l.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"]),t(E,{class:"q-my-xs",modelValue:o.category,"onUpdate:modelValue":e[4]||(e[4]=a=>o.category=a),label:"\u5206\u985E",color:"warning",options:S},null,8,["modelValue"]),c("div",de,[t(_,{class:"q-my-xs",modelValue:o.price,"onUpdate:modelValue":e[5]||(e[5]=a=>o.price=a),modelModifiers:{number:!0},label:"\u50F9\u683C",type:"number",color:"warning",rules:[l.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"]),t(O,{class:"q-my-xs",modelValue:o.sell,"onUpdate:modelValue":e[6]||(e[6]=a=>o.sell=a),label:"\u4E0A\u67B6",color:"warning"},null,8,["modelValue"])])]),c("div",ue,[t(R,{class:"q-my-sm",src:o.image,width:"150px"},null,8,["src"]),t(W,{class:"q-my-xs",modelValue:o.image,"onUpdate:modelValue":e[7]||(e[7]=a=>o.image=a),outlined:"","use-chips":"",style:{width:"150px"},label:"PHOTO"},null,8,["modelValue"])])]),t(_,{modelValue:o.description,"onUpdate:modelValue":e[8]||(e[8]=a=>o.description=a),label:"\u8AAA\u660E",type:"textarea",color:"warning",rows:"4",rules:[l.$rules.required("\u6B04\u4F4D\u5FC5\u586B")]},null,8,["modelValue","rules"])]),_:1}),t(X,{align:"center"},{default:r(()=>[t(p,{type:"submit",size:"md",color:"secondary"},{default:r(()=>[B("\u78BA\u5B9A")]),_:1}),M((f(),b(p,{size:"md",color:"pink"},{default:r(()=>[B("\u53D6\u6D88")]),_:1})),[[le]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Qe as default};
